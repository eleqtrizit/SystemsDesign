
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../CAP%20Theorum/">
      
      
        <link rel="next" href="../How%20to%20Design%20Large%20Scale%20Systems/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.3.1">
    
    
      
        <title>Distributed System Fundamentals - Systems Design</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.046329b4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#distributed-system-fundamentals" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Systems Design" class="md-header__button md-logo" aria-label="Systems Design" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Systems Design
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Distributed System Fundamentals
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="yellow"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Systems Design" class="md-nav__button md-logo" aria-label="Systems Design" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Systems Design
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Systems Design and Coding
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Designing Data Intensive Applications
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Designing Data Intensive Applications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Cliff Notes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Cliff Notes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Designing%20Data%20Intensive%20Applications/Cliff%20Notes/Cliff%20Notes%20-%20Someguy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Designing Data-Intensive Applications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Designing%20Data%20Intensive%20Applications/Cliff%20Notes/Cliff%20Notes%20-%20moyano83/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Designing Data Intensive Applications
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Designing Systems
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Designing Systems
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../CAP%20Theorum/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CAP Theorum
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Distributed System Fundamentals
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Distributed System Fundamentals
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#acid" class="md-nav__link">
    ACID
  </a>
  
    <nav class="md-nav" aria-label="ACID">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-durability-consistency" class="md-nav__link">
    Data Durability &amp; Consistency
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replication" class="md-nav__link">
    Replication
  </a>
  
    <nav class="md-nav" aria-label="Replication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#leaders-and-followers" class="md-nav__link">
    Leaders and followers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synchronous-vs-asynchronous" class="md-nav__link">
    Synchronous vs asynchronous
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-new-followers" class="md-nav__link">
    Setting up new followers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leader-failure-failover" class="md-nav__link">
    Leader failure: failover
  </a>
  
    <nav class="md-nav" aria-label="Leader failure: failover">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#statement-based-replication" class="md-nav__link">
    Statement-based replication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write-ahead-log-wal-shipping" class="md-nav__link">
    Write-ahead log (WAL) shipping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logical-row-based-log-replication" class="md-nav__link">
    Logical (row-based) log replication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problems-with-replication-lag" class="md-nav__link">
    Problems with replication lag
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reading-your-own-writes" class="md-nav__link">
    Reading your own writes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monotonic-reads" class="md-nav__link">
    Monotonic reads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-leader-replication" class="md-nav__link">
    Multi-leader replication
  </a>
  
    <nav class="md-nav" aria-label="Multi-leader replication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-datacenter-operation" class="md-nav__link">
    Multi-datacenter operation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consensus" class="md-nav__link">
    Consensus
  </a>
  
    <nav class="md-nav" aria-label="Consensus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#consistency-guarantees" class="md-nav__link">
    Consistency guarantees
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linearizability" class="md-nav__link">
    Linearizability
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leader-election" class="md-nav__link">
    Leader election
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ordering-and-causality" class="md-nav__link">
    Ordering and Causality
  </a>
  
    <nav class="md-nav" aria-label="Ordering and Causality">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-points" class="md-nav__link">
    Key points
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#total-order-broadcast" class="md-nav__link">
    Total Order Broadcast
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#partitioning" class="md-nav__link">
    Partitioning
  </a>
  
    <nav class="md-nav" aria-label="Partitioning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#partitioning-types" class="md-nav__link">
    Partitioning Types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secondary-indexes" class="md-nav__link">
    Secondary Indexes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-index" class="md-nav__link">
    Global Index
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distributed-transactions" class="md-nav__link">
    Distributed Transactions
  </a>
  
    <nav class="md-nav" aria-label="Distributed Transactions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#atomic-commit-and-two-phase-commit-2pc" class="md-nav__link">
    Atomic commit and two-phase commit (2PC)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fault-tolerant-consensus" class="md-nav__link">
    Fault-tolerant consensus
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage-and-retrieval" class="md-nav__link">
    Storage and Retrieval
  </a>
  
    <nav class="md-nav" aria-label="Storage and Retrieval">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#write-log" class="md-nav__link">
    Write Log
  </a>
  
    <nav class="md-nav" aria-label="Write Log">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#types-of-indexes" class="md-nav__link">
    Types of Indexes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-warehousing" class="md-nav__link">
    Data Warehousing
  </a>
  
    <nav class="md-nav" aria-label="Data Warehousing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#column-oriented-storage" class="md-nav__link">
    Column-oriented storage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../How%20to%20Design%20Large%20Scale%20Systems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Design Large Scale Systems
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../System%20Design%20Interview%20Steps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    System Design Interview Steps
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Specifics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Specifics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/Asynchronism/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Asynchronism
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/Caching/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cache
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/Databases/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Databases
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/File%20Systems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    File Systems
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/Google%20Systems%20Design%20-%20Code%20Deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Google Systems Design - Code Deployment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/HTTP/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/Linux%20Commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Commands
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/Linux%20Interview%20Questions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux Interview Questions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/Linux%20Networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IP
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/Linux%20OS%20Internals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux OS Internals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/Load%20Balancers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Load Balancers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/Networking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Networking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/SRE%20Interview%20Questions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SRE Interview Questions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/SSH/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SSH
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/Systems%20Design%20Template/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Systems Design Template
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/Troubleshooting%20via%20Metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Troubleshooting via Metrics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/Unix%20Processes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Linux/Unix Processes
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../Specifics/What%20happens%20when%20you%20type%20google.com%20into%20a%20browser/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What happens when you type "google.com" into a browser?
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#acid" class="md-nav__link">
    ACID
  </a>
  
    <nav class="md-nav" aria-label="ACID">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#data-durability-consistency" class="md-nav__link">
    Data Durability &amp; Consistency
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#replication" class="md-nav__link">
    Replication
  </a>
  
    <nav class="md-nav" aria-label="Replication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#leaders-and-followers" class="md-nav__link">
    Leaders and followers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#synchronous-vs-asynchronous" class="md-nav__link">
    Synchronous vs asynchronous
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setting-up-new-followers" class="md-nav__link">
    Setting up new followers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leader-failure-failover" class="md-nav__link">
    Leader failure: failover
  </a>
  
    <nav class="md-nav" aria-label="Leader failure: failover">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#statement-based-replication" class="md-nav__link">
    Statement-based replication
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#write-ahead-log-wal-shipping" class="md-nav__link">
    Write-ahead log (WAL) shipping
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#logical-row-based-log-replication" class="md-nav__link">
    Logical (row-based) log replication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#problems-with-replication-lag" class="md-nav__link">
    Problems with replication lag
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reading-your-own-writes" class="md-nav__link">
    Reading your own writes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#monotonic-reads" class="md-nav__link">
    Monotonic reads
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multi-leader-replication" class="md-nav__link">
    Multi-leader replication
  </a>
  
    <nav class="md-nav" aria-label="Multi-leader replication">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#multi-datacenter-operation" class="md-nav__link">
    Multi-datacenter operation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consensus" class="md-nav__link">
    Consensus
  </a>
  
    <nav class="md-nav" aria-label="Consensus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#consistency-guarantees" class="md-nav__link">
    Consistency guarantees
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linearizability" class="md-nav__link">
    Linearizability
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#leader-election" class="md-nav__link">
    Leader election
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ordering-and-causality" class="md-nav__link">
    Ordering and Causality
  </a>
  
    <nav class="md-nav" aria-label="Ordering and Causality">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#key-points" class="md-nav__link">
    Key points
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#total-order-broadcast" class="md-nav__link">
    Total Order Broadcast
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#partitioning" class="md-nav__link">
    Partitioning
  </a>
  
    <nav class="md-nav" aria-label="Partitioning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#partitioning-types" class="md-nav__link">
    Partitioning Types
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#secondary-indexes" class="md-nav__link">
    Secondary Indexes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#global-index" class="md-nav__link">
    Global Index
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distributed-transactions" class="md-nav__link">
    Distributed Transactions
  </a>
  
    <nav class="md-nav" aria-label="Distributed Transactions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#atomic-commit-and-two-phase-commit-2pc" class="md-nav__link">
    Atomic commit and two-phase commit (2PC)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fault-tolerant-consensus" class="md-nav__link">
    Fault-tolerant consensus
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage-and-retrieval" class="md-nav__link">
    Storage and Retrieval
  </a>
  
    <nav class="md-nav" aria-label="Storage and Retrieval">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#write-log" class="md-nav__link">
    Write Log
  </a>
  
    <nav class="md-nav" aria-label="Write Log">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#types-of-indexes" class="md-nav__link">
    Types of Indexes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-warehousing" class="md-nav__link">
    Data Warehousing
  </a>
  
    <nav class="md-nav" aria-label="Data Warehousing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#column-oriented-storage" class="md-nav__link">
    Column-oriented storage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="distributed-system-fundamentals">Distributed System Fundamentals<a class="headerlink" href="#distributed-system-fundamentals" title="Permanent link">&para;</a></h1>
<h2 id="acid">ACID<a class="headerlink" href="#acid" title="Permanent link">&para;</a></h2>
<p>In computer science, ACID (atomicity, consistency, isolation, durability) is a set of properties of database transactions intended to guarantee data validity despite errors, power failures, and other mishaps.</p>
<h3 id="data-durability-consistency">Data Durability &amp; Consistency<a class="headerlink" href="#data-durability-consistency" title="Permanent link">&para;</a></h3>
<p>The differences and impacts of failure rates of storage solutions and corruption rates in read-write processes.  </p>
<p>Durability guarantees that once a transaction has been committed, it will remain committed even in the case of a system failure (e.g., power outage or crash). This usually means that completed transactions (or their effects) are recorded in non-volatile memory.</p>
<h2 id="replication">Replication<a class="headerlink" href="#replication" title="Permanent link">&para;</a></h2>
<p>Reasons why you might want to replicate data:
* To keep data geographically close to your users
* Increase availability
* Increase read throughput</p>
<h3 id="leaders-and-followers">Leaders and followers<a class="headerlink" href="#leaders-and-followers" title="Permanent link">&para;</a></h3>
<p>Every write to the database needs to be processed by every replica. The most common solution for this is called <em>leader-based replication</em> (<em>active/passive</em> or <em>master-slave replication</em>).
1. One of the replicas is designated the <em>leader</em> (<em>master</em> or <em>primary</em>). Writes to the database must send requests to the leader.
2. Other replicas are known as <em>followers</em> (<em>read replicas</em>, <em>slaves</em>, <em>secondaries</em> or <em>hot standbys</em>). The leader sends the data change to all of its followers as part of a <em>replication log</em> or <em>change stream</em>.
3. Reads can then query the leader or any of the followers, while writes are only accepted on the leader.</p>
<h3 id="synchronous-vs-asynchronous">Synchronous vs asynchronous<a class="headerlink" href="#synchronous-vs-asynchronous" title="Permanent link">&para;</a></h3>
<p>The advantage of synchronous replication is that the follower is guaranteed to have an up-to-date copy of the data. <strong>The disadvantage is that it the synchronous follower doesn't respond, the write cannot be processed.</strong></p>
<p>It's impractical for all followers to be synchronous. If you enable synchronous replication on a database, it usually means that <em>one</em> of the followers is synchronous, and the others are asynchronous.</p>
<h3 id="setting-up-new-followers">Setting up new followers<a class="headerlink" href="#setting-up-new-followers" title="Permanent link">&para;</a></h3>
<p>Setting up a follower can usually be done without downtime. The process looks like:
1. Take a snapshot of the leader's database
2. Copy the snapshot to the follower node
3. Follower requests data changes that have happened since the snapshot was taken
4. Once follower processed the backlog of data changes since snapshot, it has <em>caught up</em>.</p>
<p>Process is similar for followers that fell off-line.</p>
<h3 id="leader-failure-failover">Leader failure: failover<a class="headerlink" href="#leader-failure-failover" title="Permanent link">&para;</a></h3>
<p>Automatic failover consists:
1. Determining that the leader has failed. If a node does not respond in a period of time it's considered dead.
2. Choosing a new leader. The best candidate for leadership is usually the replica with the most up-to-date changes from the old leader.
3. Reconfiguring the system to use the new leader. The system needs to ensure that the old leader becomes a follower and recognises the new leader.</p>
<h4 id="statement-based-replication">Statement-based replication<a class="headerlink" href="#statement-based-replication" title="Permanent link">&para;</a></h4>
<p>The leader logs every <em>statement</em> and sends it to its followers (every <code>INSERT</code>, <code>UPDATE</code> or <code>DELETE</code>).</p>
<p>This type of replication has some problems:
* <span style="color:red">Non-deterministic functions such as <code>NOW()</code> or <code>RAND()</code> will generate different values on replicas.</span>
* Statements that depend on existing data, like auto-increments, must be executed in the same order in each replica.
* Statements with side effects may result on different results on each replica.</p>
<p>A solution to this is to replace any nondeterministic function with a fixed return value in the leader.</p>
<h4 id="write-ahead-log-wal-shipping">Write-ahead log (WAL) shipping<a class="headerlink" href="#write-ahead-log-wal-shipping" title="Permanent link">&para;</a></h4>
<p>The log is an append-only sequence of bytes containing all writes to the database.  This way of replication is used in PostgresSQL and Oracle. The main disadvantage is that the log describes the data at a very low level (like which bytes were changed in which disk blocks), coupling it to the storage engine.</p>
<p>Usually is not possible to run different versions of the database in leaders and followers.</p>
<h4 id="logical-row-based-log-replication">Logical (row-based) log replication<a class="headerlink" href="#logical-row-based-log-replication" title="Permanent link">&para;</a></h4>
<ul>
<li>For an inserted row, the new values of all columns.</li>
<li>For a deleted row, the information that uniquely identifies that column.</li>
<li>For an updated row, the information to uniquely identify that row and all the new values of the columns.</li>
</ul>
<p>Since logical log is decoupled from the storage engine internals, it's easier to make it backwards compatible.</p>
<p>Logical logs are also easier for external applications to parse, useful for data warehouses, custom indexes and caches (<em>change data capture</em>).</p>
<h3 id="problems-with-replication-lag">Problems with replication lag<a class="headerlink" href="#problems-with-replication-lag" title="Permanent link">&para;</a></h3>
<p>In a <em>read-scaling</em> architecture, you can increase the capacity for serving read-only requests simply by adding more followers. However, this only realistically works on asynchronous replication. The more nodes you have, the likelier is that one will be down, so a fully synchronous configuration would be unreliable.</p>
<p>With an asynchronous approach, a follower may fall behind, leading to inconsistencies in the database (<em>eventual consistency</em>).</p>
<p>The <em>replication lag</em> could be a fraction of a second or several seconds or even minutes.</p>
<h3 id="reading-your-own-writes">Reading your own writes<a class="headerlink" href="#reading-your-own-writes" title="Permanent link">&para;</a></h3>
<p><em>Read-after-write consistency</em>, also known as <em>read-your-writes consistency</em> is a guarantee that if the user reloads the page, they will always see any updates they submitted themselves.</p>
<p>How to implement it:
* After writing, ensure the user reads from the leader (or synchronous copies)
* The client can remember the timestamp of the most recent write, then the system can ensure that the replica serving any reads for that user reflects updates at least until that timestamp.
* Ensure usage of same datacenter
* You may want to provide <em>cross-device</em> read-after-write consistency for the same user</p>
<h3 id="monotonic-reads">Monotonic reads<a class="headerlink" href="#monotonic-reads" title="Permanent link">&para;</a></h3>
<p>Ensure the user reads from the same replica, so they do not experience time discrepencies (such as time moving backward due to lag)</p>
<h3 id="multi-leader-replication">Multi-leader replication<a class="headerlink" href="#multi-leader-replication" title="Permanent link">&para;</a></h3>
<p>Leader-based replication has one major downside: there is only one leader, and all writes must go through it.</p>
<p>A natural extension is to allow more than one node to accept writes (<em>multi-leader</em>, <em>master-master</em> or <em>active/active</em> replication) where each leader simultaneously acts as a follower to the other leaders.</p>
<h5 id="multi-datacenter-operation">Multi-datacenter operation<a class="headerlink" href="#multi-datacenter-operation" title="Permanent link">&para;</a></h5>
<p>You can have a leader in <em>each</em> datacenter. Within each datacenter, regular leader-follower replication is used. Between datacenters, each datacenter leader replicates its changes to the leaders in other datacenters.</p>
<p>Compared to a single-leader replication model deployed in multi-datacenters
* <strong>Performance.</strong> With single-leader, every write must go across the internet to wherever the leader is, adding significant latency. In multi-leader every write is processed in the local datacenter and replicated asynchronously to other datacenters. The network delay is hidden from users and perceived performance may be better.
* <strong>Tolerance of datacenter outages.</strong> In single-leader if the datacenter with the leader fails, failover can promote a follower in another datacenter. In multi-leader, each datacenter can continue operating independently from others.
* <strong>Tolerance of network problems.</strong> Single-leader is very sensitive to problems in this inter-datacenter link as writes are made synchronously over this link. Multi-leader with asynchronous replication can tolerate network problems better.</p>
<p>It's common to fall on subtle configuration pitfalls. Autoincrementing keys, triggers and integrity constraints can be problematic. Multi-leader replication is often considered dangerous territory and avoided if possible.</p>
<h2 id="consensus">Consensus<a class="headerlink" href="#consensus" title="Permanent link">&para;</a></h2>
<p>Ensuring all nodes are in agreement, which prevents fault processes from running and ensures consistency and replication of data and processes</p>
<h3 id="consistency-guarantees">Consistency guarantees<a class="headerlink" href="#consistency-guarantees" title="Permanent link">&para;</a></h3>
<ul>
<li>Do we need data guarantees or is eventual consistency (convergence) OK?</li>
<li>Stronger guarantees have worse performance</li>
</ul>
<h3 id="linearizability">Linearizability<a class="headerlink" href="#linearizability" title="Permanent link">&para;</a></h3>
<ul>
<li>Make system <em>appear</em> as if it has only one copy of the data and looks atomic<ul>
<li>Once new values are read, never return old ones</li>
<li>Make data appear serialized -as if they executed in order</li>
<li>recency guaranteed on reads and writes</li>
</ul>
</li>
<li>How different systems are<ul>
<li>Single-leader repolication is potentially linearizable.</li>
<li>Consensus algorithms is linearizable.</li>
<li>Multi-leader replication is not linearizable.</li>
<li>Leaderless replication is probably not linearizable.</li>
</ul>
</li>
<li>Multi-leader replication is often a good choice for multi-datacenter replication. On a network interruption between data-centers will force a choice between linearizability and availability.<ul>
<li>With multi-leader configuraiton, each data center can operate normally with interruptions.</li>
<li><strong>If an application does not require linearizability it can be more tolerant of network problems.</strong></li>
</ul>
</li>
</ul>
<h3 id="leader-election">Leader election<a class="headerlink" href="#leader-election" title="Permanent link">&para;</a></h3>
<ul>
<li>All (or voting) nodes must agree on the leader via a lock</li>
<li>Apache Zookeeper and etcd are often used for distributed locks</li>
<li><strong>Voting</strong><ul>
<li>Mostly a synchronous operation</li>
<li>Votes are held if the slave nodes believe the master is dead</li>
<li>If a predefined fixed # of nodes are selected to vote, then you can't just remove these systems from the cluster</li>
<li>Network issues, especially across geographic regions, can cause mass voting</li>
<li><strong>Too much voting prevents work from getting done.</strong></li>
</ul>
</li>
</ul>
<h3 id="ordering-and-causality">Ordering and Causality<a class="headerlink" href="#ordering-and-causality" title="Permanent link">&para;</a></h3>
<ul>
<li>Order preserves causality</li>
<li>Rows must exist before modification</li>
<li>Detect concurrent writes</li>
<li>In order to determine casual ordering<ul>
<li>Database needs to know which copy of the data was read before write<ul>
<li>use versions</li>
</ul>
</li>
<li>with single leader replication, master can just increment a number</li>
<li>With multi-leader, you can use something like Lamport timestamps<ul>
<li>combo of timestamp and node ID where the largest numbers wins.</li>
<li>Each node sends out the lamport timetamp on each request</li>
<li>Client sends back these timestamps. If another replica gets a future request with a larger timestamp, the server updates.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="key-points">Key points<a class="headerlink" href="#key-points" title="Permanent link">&para;</a></h4>
<ul>
<li>Linearizability is stronger than causal consistency<ul>
<li>Linearizability implies causality</li>
</ul>
</li>
<li>Causal consistency is the strongest possible consistency model that does not slow down due to network delays, and remains available in the face of network failures.<ul>
<li>The causal order is not a total order</li>
<li>Some elements will be incomparable <strong>WEAKNESS</strong></li>
<li>Timestamp ordering is not sufficient <strong>WEAKNESS</strong></li>
</ul>
</li>
</ul>
<h3 id="total-order-broadcast">Total Order Broadcast<a class="headerlink" href="#total-order-broadcast" title="Permanent link">&para;</a></h3>
<p>Total order broadcast is a protocol for exchanging messages between nodes. It requires two safety properties:
* Reliable delivery: No messages are lost a (if a message is delivered to one node, it is delivered to all nodes)
* Totally ordered delivery: Messages are delivered to every node in the same order
* Makes sure every message and write are delivered in the same order
* No guaranteed when message is delivered</p>
<p><strong>Example:</strong>
* Append a message to the log, tentatively indicating the username you want to claim
 * Read the log, and wait for the message you appended to be delivered back to you
 * Check for any messages claiming the username that you want. If the first message for your desired username is your own message, then you are successful</p>
<p>Consensus services 
* ZooKeeper
* etcd</p>
<h2 id="partitioning">Partitioning<a class="headerlink" href="#partitioning" title="Permanent link">&para;</a></h2>
<p>Replication, for very large datasets or very high query throughput is not sufficient, we need to break the data up into <em>partitions</em> (<em>sharding</em>).</p>
<h3 id="partitioning-types">Partitioning Types<a class="headerlink" href="#partitioning-types" title="Permanent link">&para;</a></h3>
<ul>
<li>key-value<ul>
<li>Good<ul>
<li>simple</li>
</ul>
</li>
<li>Bad<ul>
<li>suspectible to hot spots</li>
<li>no way of knowing what shard the data is on</li>
</ul>
</li>
</ul>
</li>
<li>key range<ul>
<li>Good<ul>
<li>Can be sorted and scanned easily</li>
<li>Know where shard is located physically</li>
</ul>
</li>
<li>Bad<ul>
<li>suspectible to hot spots</li>
</ul>
</li>
</ul>
</li>
<li>hash of key<ul>
<li>Good<ul>
<li>avoids hotspots</li>
</ul>
</li>
<li>Bad<ul>
<li>Can't do sorted range queries anymore</li>
<li>Must send range queries to all shards</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="secondary-indexes">Secondary Indexes<a class="headerlink" href="#secondary-indexes" title="Permanent link">&para;</a></h3>
<p>Each partition maintains its secondary indexes, covering only the documents in that partition (<em>local index</em>).</p>
<p>You need to send the query to <em>all</em> partitions, and combine all the results you get back (<em>scatter/gather</em>). This is prone to tail latency amplification and is widely used in MongoDB, Riak, Cassandra, Elasticsearch, SolrCloud and VoltDB.</p>
<h3 id="global-index">Global Index<a class="headerlink" href="#global-index" title="Permanent link">&para;</a></h3>
<p>We construct a <em>global index</em> that covers data in all partitions. The global index must also be partitioned so it doesn't become the bottleneck.</p>
<p>The advantage is that it can make reads more efficient: rather than doing scatter/gather over all partitions, a client only needs to make a request to the partition containing the term that it wants. The downside of a global index is that writes are slower and complicated.</p>
<h2 id="distributed-transactions">Distributed Transactions<a class="headerlink" href="#distributed-transactions" title="Permanent link">&para;</a></h2>
<p>Once consensus is reached, transactions from applications need to be committed across databases with fault checks by each resource involved.</p>
<p>There are situations in which it is important for nodes to agree:
* Leader election: All nodes need to agree on which node is the leader.
* Atomic commit: Get all nodes to agree on the outcome of the transacction, either they all abort or roll back.</p>
<h3 id="atomic-commit-and-two-phase-commit-2pc">Atomic commit and two-phase commit (2PC)<a class="headerlink" href="#atomic-commit-and-two-phase-commit-2pc" title="Permanent link">&para;</a></h3>
<p>2PC is also called a <em>blocking</em> atomic commit protocol, as 2Pc can become stuck waiting for the coordinator to recover. Heavy performance penalty.
* If all participants reply "yes", the coordinator sends out a <em>commit</em> request in phase 2, and the commit takes place.
* If any of the participants replies "no", the coordinator sends an <em>abort</em> request to all nodes in phase 2.
* The problem with <em>locking</em> is that database transactions usually take a row-level exclusive lock on any rows they modify, to prevent dirty writes.
* If Coordinator fails, human interaction is required, otherwise orphaned updates and locks may linger in database forever.</p>
<h3 id="fault-tolerant-consensus">Fault-tolerant consensus<a class="headerlink" href="#fault-tolerant-consensus" title="Permanent link">&para;</a></h3>
<p>One or more nodes may <em>propose</em> values, and the consensus algorithm <em>decides</em> on those values.</p>
<p>Consensus algorithm must satisfy the following properties:
* Uniform agreement: No two nodes decide differently.
* Integrity: No node decides twice.
* Validity: If a node decides the value <em>v</em>, then <em>v</em> was proposed by some node.
* Termination: Every node that does not crash eventually decides some value.</p>
<p>So total order broadcast is equivalent to repeated rounds of consensus:
* Due to agreement property, all nodes decide to deliver the same messages in the same order.
* Due to integrity, messages are not duplicated.
* Due to validity, messages are not corrupted.
* Due to termination, messages are not lost.</p>
<h2 id="storage-and-retrieval">Storage and Retrieval<a class="headerlink" href="#storage-and-retrieval" title="Permanent link">&para;</a></h2>
<h3 id="write-log">Write Log<a class="headerlink" href="#write-log" title="Permanent link">&para;</a></h3>
<p>Most databases use an append-only log.  To avoid the log from growing too big, you can close a log and start a new one.  Then, compact the older logs.</p>
<h4 id="types-of-indexes">Types of Indexes<a class="headerlink" href="#types-of-indexes" title="Permanent link">&para;</a></h4>
<p>Indexes speed up retrieval.
* Hash Indexes
* SSTables
* LSM-Trees
* B-Trees</p>
<h3 id="data-warehousing">Data Warehousing<a class="headerlink" href="#data-warehousing" title="Permanent link">&para;</a></h3>
<p>A <em>data warehouse</em> is a separate database that analysts can query to their heart's content without affecting OLTP operations. It contains read-only copy of the dat in all various OLTP systems in the company. Data is extracted out of OLTP databases (through periodic data dump or a continuous stream of update), transformed into an analysis-friendly schema, cleaned up, and then loaded into the data warehouse (process <em>Extract-Transform-Load</em> or ETL).</p>
<h4 id="column-oriented-storage">Column-oriented storage<a class="headerlink" href="#column-oriented-storage" title="Permanent link">&para;</a></h4>
<p>In a row-oriented storage engine, when you do a query that filters on a specific field, the engine will load all those rows with all their fields into memory, wasting lots of resoruces</p>
<p><em>Column-oriented storage</em> is simple: don't store all the values from one row together, but store all values from each <em>column</em> together instead. Only load what is needed.  </p>
<p>Column-oriented storage is more CPU effecient and can be compressed for faster loading.</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
    
  </body>
</html>